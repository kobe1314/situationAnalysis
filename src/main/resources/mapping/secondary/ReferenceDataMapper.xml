<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.situation.analysis.mapper.secondary.ReferenceDataMapper">

    <resultMap id="response" type="ResultEntity">
        <result column="civilcode" property="civilcode"/>
        <result column="totalRecords" property="totalRecords"/>
        <result column="successRecords" property="successRecords"/>
        <result column="failRecords" property="failRecords"/>
        <result column="offlineDuration" property="offlineDuration"/>
    </resultMap>

    <resultMap id="ThirdResult" type="ThirdResultEntity">
        <result column="areaId" property="areaId"/>
        <result column="areaName" property="areaName"/>
    </resultMap>

    <select id="checkTaskResultRecord4A11" resultMap="response">
        select sum(offlineduration) offlineDuration, count(*) totalRecords from rm_outdeviceinfo;
    </select>

    <select id="checkTaskResultRecord4A11ByGroup" resultMap="response">
        select civilcode, sum(offlineduration) offlineDuration, count(*) totalRecords from rm_outdeviceinfo group by civilcode;
    </select>

    <select id="checkTaskResultRecord4A12" parameterType="int" resultMap="response">
        select count(*) totalRecords, count(if(errcode = 200,true,null)) successRecords from rm_task_result where taskno = #{taskNum};
    </select>

    <select id="checkTaskResultRecord4A12ByGroup" parameterType="int" resultMap="response">
        select civilcode, count(*) totalRecords, count(if(errcode = 200,true,null)) successRecords from rm_task_result where taskno = #{taskNum} group by civilcode;
    </select>


    <select id="checkTaskResultRecord4A13" parameterType="int" resultMap="response">
        select count(*) totalRecords, count(if(errcode in(904,905,907),true,null)) failRecords from rm_task_result where taskno = #{taskNum};
    </select>

    <select id="checkTaskResultRecord4A13ByGroup" parameterType="int" resultMap="response">
        select civilcode, count(*) totalRecords, count(if(errcode in(904,905,907),true,null)) failRecords from rm_task_result where taskno = #{taskNum} group by civilcode;
    </select>

    <select id="checkTaskResultRecord4A14" resultMap="response">
        select count(*) totalRecords, count(if(status = 0 ,true,null)) failRecords from rm_outdeviceinfo;
    </select>

    <select id="checkTaskResultRecord4A14ByGroup" resultMap="response">
        select civilcode, count(*) totalRecords, count(if(status = 0 ,true,null)) failRecords from rm_outdeviceinfo group by civilcode;
    </select>

    <select id="getTaskIds" parameterType="int" resultType="object">
        select taskId from rm_task where tasktype = #{taskType};
    </select>

    <select id="checkTaskResultRecord4C" resultMap="response">
        select count(*) totalRecords from rm_task_result where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>

    <select id="getVqdresList" resultType="string">
        select vqdres from rm_task_result where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>

    <select id="checkTaskResultRecord4C12" resultMap="response">
        select count(*) totalRecords, count(if(status = 1 ,true,null)) successRecords from rm_diag_osd where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>


    <select id="checkTaskResultRecord4C22" resultMap="response">
        select count(*) totalRecords, count(if(status = 1 ,true,null)) successRecords from rm_videofull_diag_result where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>


    <select id="checkTaskResultRecord4C23" resultMap="response">
        select count(*) totalRecords, count(if(status = 1 ,true,null)) successRecords from rm_diag_osd where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>

    <select id="checkTaskResultRecord4A21" resultMap="response">
        select sum(offlineduration) offlineDuration, count(*) totalRecords from rm_apeinfo;
    </select>

    <select id="checkTaskResultRecord4A21ByGroup" resultMap="response">
        select sum(offlineduration) offlineDuration, count(*) totalRecords from rm_apeinfo group by civilcode;
    </select>

    <select id="checkTaskResultRecord4A22" resultMap="response">
        select count(*) totalRecords, count(if(imagenum > imagestandnum ,true,null)) successRecords from rm_stk_structured_data;
    </select>

    <select id="checkTaskResultRecord4A22ByGroup" resultMap="response">
        select count(*) totalRecords, count(if(imagenum > imagestandnum ,true,null)) successRecords from rm_stk_structured_data group by civilcode;
    </select>

    <select id="checkTaskResultRecord4A23" resultMap="response">
        select count(*) totalRecords, count(if(isonline = 0 ,true,null)) failRecords from rm_apeinfo;
    </select>

    <select id="checkTaskResultRecord4A23ByGroup" resultMap="response">
        select count(*) totalRecords, count(if(isonline = 0 ,true,null)) failRecords from rm_apeinfo group by civilcode;
    </select>



    <select id="checkTaskResultRecord4C31" resultMap="response">
        select count(*) totalRecords, count(if(status = 1 ,true,null)) successRecords from rm_diag_osd where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>

    <select id="getVqdresList4C3" resultType="string">
        select vqdres from rm_stk_diag_result where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>


    <select id="checkTaskResultRecord4C32Or34" resultMap="response">
        select count(*) totalRecords, count(if(status = 1 ,true,null)) successRecords from rm_stk_accuracy where
        <choose>
            <when test="taskIds != null and taskIds.size > 0">
                taskid IN
                <foreach collection="list" item="taskId" index="index"
                         open="(" close=")" separator=",">
                    #{taskId}
                </foreach>;
            </when>
            <otherwise>
                1 = 2
            </otherwise>
        </choose>
    </select>


    <select id="checkTaskResultRecord4C33" resultMap="response">
        select count(*) totalRecords, count(if(structurednum != 0 and imagenum != 0 ,true,null)) successRecords from rm_stk_structured_data_history group by ctime;
    </select>


    <select id="checkTaskResultRecord4D" resultMap="response">
        select count(*) totalRecords from rm_srv;
    </select>

    <select id="checkTaskResultRecord4D11" resultMap="response">
        select serviceconnectivitys totalRecords, serviceconnectivity successRecords from rm_srv_link;
    </select>

    <select id="checkTaskResultRecord4D12" resultMap="response">
        select totalvisits totalRecords, accessfailed failRecords from rm_srv_visits;
    </select>


    <select id="checkTaskResultRecord4D14" resultMap="response">
        select callnum totalRecords, callerr failRecords from rm_srv_call;
    </select>

    <select id="getChildrenCode" resultMap="ThirdResult">
        select areaId,areaName from ao_area where parentAreaId = #{code};
    </select>

    <select id="getAreaName" resultType="string">
        select areaName from ao_area where areaId = #{code};
    </select>

    <select id="getCode" resultType="string">
        select areaId from ao_area where areaName = #{name};
    </select>


</mapper>